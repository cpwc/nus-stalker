<% include head %>
<div class="text-center" style="margin-top:50px">
    <div style="padding:40px">
        <img src="img/nsa.png">
        <h3>National University of Stalkers</h3>
    </div>
    <% for (var i=0; i<messages.length; i++) { %>
        <div class="alert alert-danger alert-dismissable">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
            <%= messages[i] %>
        </div>
    <% } %>
    <form action="/search" method="get">
        <div class="form-group">
            <div class="input-group col-sm-8 col-sm-offset-2">
                <input type="text" class="typeahead form-control" name="q">
                <span class="input-group-btn">
                    <input type="submit" class="btn btn-default" value="Search">
                </span>
            </div>
        </div>
    </form>
    <div style="padding:20px">
        <p class="text-muted"><%= random %></p>
    </div>
</div>
<script>
$(function(){
    var students = new Dataset({
        remote: '/student/suggest?q=%QUERY'
    }).initialize();
    
    var modules = new Dataset({
        remote: '/module/suggest?q=%QUERY'
    }).initialize();
    
    var easterEggs = new Dataset({
        local: 'Robert\'); DROP TABLE Students;--'
    }).initialize();
    
    $('.typeahead').typeahead({
        sections: [{
            highlight: true,
            name: 'modulesSection',
            source: modules,
            limit: 10,
            templates: {
                footer: '<div class="tt-header">Modules</div>'
            }
        }, {
            highlight: true,
            name: 'studentsSection',
            source: students,
            limit: 10,
            templates: {
                footer: '<div class="tt-header">Students</div>'
            }
        }, {
            highlight: true,
            name: 'easterEggSection',
            source: easterEggs,
            limit: 10
        }]                                                               
    })
    .on('typeahead:opened',function() {
        $('.tt-dropdown-menu').css('width',$('.typeahead').outerWidth() + 'px');
    })
    .on('typeahead:selected', function(obj, datum, section) {
        switch (section) {
        case 'studentsSection':
            window.location.href = '/student/' + datum.id;
            break;
        case 'modulesSection':
            window.location.href = '/module/' + datum.id;
            break;
        case 'easterEggSection':
            window.location.href = 'bobby.txt'
            break;
        }
    });
});
</script>
<% include foot %>